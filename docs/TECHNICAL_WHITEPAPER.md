# Patent-AX 기술 백서

> **AI 기반 특허 검색 및 분석 시스템**
>
> Version 1.3.0 | 2026-01-18

---

## 목차

1. [시스템 개요](#1-시스템-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [핵심 기술](#3-핵심-기술)
4. [데이터 명세](#4-데이터-명세)
5. [시스템 프로세스](#5-시스템-프로세스)
6. [API 명세](#6-api-명세)
7. [유즈케이스 시나리오](#7-유즈케이스-시나리오)
8. [운영 환경](#8-운영-환경)

**별첨**
- [A. API 엔드포인트 상세](./APPENDIX_A_API_ENDPOINTS.md)
- [B. 데이터베이스 스키마](./APPENDIX_B_DATABASE_SCHEMA.md)
- [C. 워크플로우 노드 상세](./APPENDIX_C_WORKFLOW_NODES.md)

---

## 1. 시스템 개요

### 1.1 목적

Patent-AX는 **자연어 기반 특허 검색 및 분석 시스템**입니다. 사용자의 질문을 이해하고, 특허 데이터베이스와 벡터 검색을 결합하여 정확한 답변을 생성합니다.

### 1.2 주요 기능

| 기능 | 설명 |
|------|------|
| **자연어 질의** | "배터리 관련 특허 TOP 10" 같은 자연어로 검색 |
| **하이브리드 검색** | SQL(구조화) + Vector(의미론적) 통합 검색 |
| **리터러시 레벨** | 초등학생~전문가까지 6단계 맞춤 응답 |
| **실시간 스트리밍** | SSE 기반 실시간 응답 전송 |
| **지식 그래프** | 특허 간 관계 분석 및 시각화 |

### 1.3 기술 스택

```
┌─────────────────────────────────────────────────────────────┐
│                      Frontend (Next.js 14)                  │
├─────────────────────────────────────────────────────────────┤
│                      Backend (FastAPI)                      │
├──────────────┬──────────────┬──────────────┬───────────────┤
│   LangGraph  │   SQL Agent  │  RAG Engine  │  Graph RAG    │
├──────────────┴──────────────┴──────────────┴───────────────┤
│    PostgreSQL    │    Qdrant    │    KURE    │    vLLM     │
└──────────────────┴─────────────┴────────────┴──────────────┘
```

---

## 2. 시스템 아키텍처

### 2.1 구성 요소

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 (브라우저)                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Frontend (Next.js 14.2)                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐  │
│  │  메인 페이지  │  │  Easy Mode   │  │  시각화 대시보드      │  │
│  │  (L1-L6)     │  │  (초등학생)   │  │  (그래프/벡터)        │  │
│  └──────────────┘  └──────────────┘  └──────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │ API Proxy (/api/*)
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Backend (FastAPI 0.104)                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   LangGraph Workflow                     │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────┐ │   │
│  │  │Analyzer │→│ES Scout │→│Vector   │→│SQL/RAG Node │ │   │
│  │  │         │  │         │  │Enhancer │  │             │ │   │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────────┘ │   │
│  │                                              │           │   │
│  │                                              ▼           │   │
│  │                              ┌─────────┐  ┌───────────┐ │   │
│  │                              │ Merger  │→│ Generator │ │   │
│  │                              └─────────┘  └───────────┘ │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
         │              │              │              │
         ▼              ▼              ▼              ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│  PostgreSQL  │ │    Qdrant    │ │   KURE API   │ │    vLLM      │
│  (특허 DB)   │ │  (벡터 DB)   │ │  (임베딩)    │ │  (EXAONE)    │
│  1.2M rows   │ │  1.82M pts   │ │  1024-dim    │ │  32B model   │
└──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘
```

### 2.2 서비스 포트

| 서비스 | 포트 | 역할 |
|--------|------|------|
| Frontend | 3002 | Next.js 웹 인터페이스 |
| Backend API | 8001 | FastAPI REST/SSE API |
| PostgreSQL | 5432 | 특허 메타데이터 DB |
| Qdrant | 6333 | 벡터 검색 엔진 |
| vLLM | 12288 | LLM 추론 서버 |
| KURE API | 7000 | 임베딩 서버 |

---

## 3. 핵심 기술

### 3.1 LangGraph 워크플로우

**StateGraph 기반 다단계 처리**

```
Entry → analyzer → es_scout → vector_enhancer → sql_node/rag_node → merger → generator → END
```

| 노드 | 역할 | 평균 시간 |
|------|------|----------|
| analyzer | LLM 기반 쿼리 의도 분석 | ~30초 |
| es_scout | 동의어 확장 + ES 탐색 | ~0.1초 |
| vector_enhancer | 벡터 기반 키워드 확장 | ~0.5초 |
| sql_node | PostgreSQL 쿼리 실행 | ~0.5초 |
| rag_node | Qdrant 벡터 검색 | ~0.8초 |
| merger | 결과 병합 및 중복 제거 | ~0.1초 |
| generator | LLM 응답 생성 | ~17초 |

### 3.2 하이브리드 검색 전략

쿼리 유형에 따른 **동적 검색 전략** 적용:

| Query Type | 검색 전략 | 설명 |
|------------|----------|------|
| list | SQL 우선 | 목록 조회 (TOP N) |
| aggregation | SQL 전용 | 통계/집계 (GROUP BY) |
| concept | Vector 우선 | 개념 설명 (의미 검색) |
| ranking | ES+Vector | 순위 (RRF 병합) |
| hybrid | SQL+Vector 병렬 | 복합 검색 |

### 3.3 리터러시 레벨 시스템 (v1.3)

| 레벨 | 대상 | 응답 특성 |
|------|------|----------|
| L1 | 초등학생 | 쉬운 용어, 이모지, 간단한 설명 |
| L2 | 대학생/일반인 | 기본 전문용어, 적절한 상세도 |
| L3 | 중소기업 실무자 | 실무 관점, 활용 사례 |
| L4 | 연구자 | 기술적 상세, 참고문헌 |
| L5 | 변리사/심사관 | 법률 용어, 청구항 분석 |
| L6 | 정책담당자 | 통계 중심, 정책 시사점 |

### 3.4 LLM 모델

**EXAONE 4.0.1-32B** (LG AI Research)

- Reasoning Mode 지원 (`<think>` 태그)
- 한국어 최적화
- OpenAI 호환 API (vLLM)

---

## 4. 데이터 명세

### 4.1 데이터 규모

| 데이터 | 규모 | 설명 |
|--------|------|------|
| 특허 문서 | 1.2M 건 | 한국/미국/일본/중국 특허 |
| 벡터 포인트 | 1.82M 개 | 1024차원 임베딩 |
| 출원인 정보 | 600K 건 | 기관/개인 정보 |

### 4.2 주요 테이블

| 테이블 | 설명 | 주요 컬럼 |
|--------|------|----------|
| f_patents | 특허 정보 | documentid, ipc_main, patent_abstc_ko |
| f_patent_applicants | 출원인 | document_id, applicant_name |
| patent_ipc_normalized | IPC 정규화 | documentid, ipc_code, ipc_name |

> 상세 스키마: [별첨 B. 데이터베이스 스키마](./APPENDIX_B_DATABASE_SCHEMA.md)

### 4.3 벡터 컬렉션

```yaml
Collection: patents_v3_collection
Dimension: 1024
Points: 1,820,000
Size: 9.4 GB
Embedding: KURE API (BGE-M3 기반)
```

---

## 5. 시스템 프로세스

### 5.1 쿼리 처리 흐름

```
사용자 질문: "배터리 특허 TOP 10 알려줘"
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│ [1] Analyzer: LLM 의도 분석                                  │
│     - query_type: "sql"                                      │
│     - query_subtype: "ranking"                               │
│     - entity_types: ["patent"]                               │
│     - keywords: ["배터리"]                                   │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│ [2] ES Scout: 동의어 확장                                    │
│     - 배터리 → [배터리, battery, 축전지, 이차전지, ...]     │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│ [3] Vector Enhancer: 키워드 확장                             │
│     - Qdrant 검색 → 관련 특허 추출 → 키워드 추가            │
│     - expanded: ["리튬이온", "전고체", "양극재"]             │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│ [4] SQL Executor: 데이터베이스 조회                          │
│     - SELECT ... FROM f_patents WHERE ... LIMIT 10          │
│     - 10건 반환                                              │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│ [5] Generator: 응답 생성                                     │
│     - 리터러시 레벨에 맞춰 마크다운 응답 생성               │
│     - 표, 소결, 시사점 포함                                  │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
            최종 응답 (SSE 스트리밍)
```

### 5.2 스트리밍 이벤트 흐름

```
event: status       data: {"status": "analyzing", "message": "쿼리 분석 중..."}
event: analysis_complete  data: {"query_type": "sql", "keywords": [...]}
event: status       data: {"status": "executing_sql"}
event: sql_complete data: {"row_count": 10, "columns": [...]}
event: text         data: "### 배터리 특허 TOP 10\n\n..."
event: stage_timing data: {"analyzer_ms": 30000, "generator_ms": 17000}
event: done         data: {"sources": [...], "confidence_score": 0.85}
```

---

## 6. API 명세

### 6.1 주요 엔드포인트

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/health` | 헬스 체크 |
| POST | `/workflow/chat/stream` | SSE 스트리밍 채팅 |
| POST | `/search` | 벡터 검색 |
| POST | `/sql/query` | 자연어 SQL 실행 |
| GET | `/collections` | 컬렉션 목록 |

### 6.2 스트리밍 채팅 API

**Request**
```http
POST /workflow/chat/stream
Content-Type: application/json

{
  "query": "배터리 특허 알려줘",
  "session_id": "user123",
  "level": "L2"
}
```

**Response (SSE)**
```
event: status
data: {"status": "analyzing", "message": "쿼리를 분석하고 있습니다..."}

event: text
data: "### 배터리 특허 분석\n\n..."

event: done
data: {"sources": [...], "elapsed_ms": 55000}
```

> 상세 API 명세: [별첨 A. API 엔드포인트 상세](./APPENDIX_A_API_ENDPOINTS.md)

---

## 7. 유즈케이스 시나리오

### 7.1 시나리오 1: 특허 목록 조회

**사용자**: "AI 반도체 특허 10개 보여줘"

**시스템 처리**:
1. Analyzer: query_type=sql, subtype=list
2. SQL 생성: `SELECT ... WHERE ipc_main LIKE 'H01L%' AND ... LIMIT 10`
3. 결과: 10건의 특허 목록 (특허명, 출원인, 출원일)

### 7.2 시나리오 2: 통계 분석

**사용자**: "2023년 배터리 특허 출원 현황 분석해줘"

**시스템 처리**:
1. Analyzer: query_type=sql, subtype=trend_analysis
2. ES Aggregation: 월별/분기별 출원 건수 집계
3. 결과: 통계 표 + 트렌드 분석 + 시사점

### 7.3 시나리오 3: 개념 설명

**사용자**: "전고체 배터리가 뭐야?" (L1 레벨)

**시스템 처리**:
1. Analyzer: query_type=rag, subtype=concept
2. Qdrant 벡터 검색: 전고체 배터리 관련 특허 20건
3. 결과: 쉬운 용어로 설명 + 이모지 + 관련 특허 예시

### 7.4 시나리오 4: 복합 질의

**사용자**: "삼성전자 특허와 LG화학 특허 비교해줘"

**시스템 처리**:
1. Analyzer: is_compound=true, sub_queries 분해
2. 병렬 실행: 삼성전자 SQL + LG화학 SQL
3. Merger: 결과 통합
4. 결과: 비교 표 + 분석

---

## 8. 운영 환경

### 8.1 서버 구성

| 역할 | IP | 사양 |
|------|-----|------|
| API 서버 | 3.34.237.73 | 애플리케이션 서버 |
| GPU 서버 | 210.109.80.106 | vLLM, Qdrant, KURE |
| DB 서버 | localhost | PostgreSQL |

### 8.2 환경 변수

```bash
# 데이터베이스
DB_HOST=localhost
DB_PORT=5432
DB_NAME=ax
DB_USER=postgres

# 벡터 검색
QDRANT_URL=http://210.109.80.106:6333

# LLM
VLLM_BASE_URL=http://210.109.80.106:12288

# 임베딩
KURE_API_URL=http://210.109.80.106:7000/api/embedding
```

### 8.3 모니터링

| 항목 | 엔드포인트 | 정상 응답 |
|------|-----------|----------|
| API 서버 | `/health` | `{"status": "healthy"}` |
| Qdrant | `:6333/collections` | 컬렉션 목록 |
| vLLM | `:12288/health` | HTTP 200 |

---

## 라이선스

Copyright 2026. All rights reserved.

---

**문서 정보**
- 작성일: 2026-01-18
- 버전: 1.0.0
- 작성: Claude (Anthropic)
